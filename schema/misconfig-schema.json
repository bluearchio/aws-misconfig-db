{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/aws-misconfig-db/schema/misconfig-schema.json",
  "title": "AWS Misconfiguration Entry",
  "description": "Schema for AWS misconfiguration database entries",
  "type": "object",
  "required": [
    "id",
    "service_name",
    "scenario",
    "risk_detail"
  ],
  "properties": {
    "id": {
      "type": "string",
      "description": "Unique identifier for the misconfiguration entry (UUID format)",
      "pattern": "^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$"
    },
    "status": {
      "type": "string",
      "description": "Current status of the misconfiguration entry",
      "enum": ["done", "ice", "open", "pending"]
    },
    "service_name": {
      "type": "string",
      "description": "AWS service affected by this misconfiguration",
      "examples": ["ec2", "rds", "s3", "lambda", "iam", "vpc", "cloudfront", "elb", "alb"]
    },
    "scenario": {
      "type": "string",
      "description": "Brief description of the misconfiguration scenario"
    },
    "alert_criteria": {
      "type": "string",
      "description": "Specific conditions or metrics that trigger this alert"
    },
    "recommendation_action": {
      "type": "string",
      "description": "Recommended action to remediate the misconfiguration"
    },
    "risk_detail": {
      "type": "string",
      "description": "Type of risk associated with this misconfiguration. Can be a single value or comma-separated list of: cost, security, operations, performance, reliability",
      "pattern": "^(cost|security|operations|performance|reliability)(,\\s*(cost|security|operations|performance|reliability))*$"
    },
    "build_priority": {
      "type": "integer",
      "description": "Priority level for addressing this misconfiguration (0-3, where 0 is highest)",
      "minimum": 0,
      "maximum": 3
    },
    "action_value": {
      "type": ["integer", "null"],
      "description": "Value metric for the recommended action",
      "minimum": 0
    },
    "effort_level": {
      "type": ["integer", "null"],
      "description": "Level of effort required to implement the recommendation (1-3)",
      "minimum": 0,
      "maximum": 3
    },
    "risk_value": {
      "type": ["integer", "null"],
      "description": "Severity value of the risk (0-3)",
      "minimum": 0,
      "maximum": 3
    },
    "recommendation_description_detailed": {
      "type": "string",
      "description": "Detailed explanation of the recommendation and its benefits"
    },
    "category": {
      "type": "string",
      "description": "Category of AWS resource or service type",
      "examples": ["compute", "networking", "database", "storage", "security"]
    },
    "output_notes": {
      "type": "string",
      "description": "Additional output notes, pros and cons"
    },
    "notes": {
      "type": "string",
      "description": "Additional notes or context about the misconfiguration"
    },
    "references": {
      "type": "array",
      "description": "Array of reference URLs for documentation and resources",
      "items": {
        "type": "string",
        "format": "uri"
      },
      "maxItems": 10
    },
    "metadata": {
      "type": "object",
      "description": "Metadata about the entry",
      "properties": {
        "created_at": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp when the entry was created"
        },
        "updated_at": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp when the entry was last updated"
        },
        "contributors": {
          "type": "array",
          "description": "List of contributors who have worked on this entry",
          "items": {
            "type": "string"
          }
        },
        "source": {
          "type": "string",
          "description": "Original source of this misconfiguration entry",
          "examples": ["AWS Trusted Advisor", "AWS Well-Architected Framework", "Community Contribution"]
        }
      }
    },
    "tags": {
      "type": "array",
      "description": "Searchable tags for categorization",
      "items": {
        "type": "string"
      },
      "uniqueItems": true
    },
    "cve_references": {
      "type": "array",
      "description": "Related CVE identifiers if applicable",
      "items": {
        "type": "string",
        "pattern": "^CVE-[0-9]{4}-[0-9]+$"
      }
    },
    "compliance_mappings": {
      "type": "array",
      "description": "Compliance frameworks this relates to",
      "items": {
        "type": "string",
        "examples": ["PCI-DSS", "HIPAA", "SOC2", "CIS", "NIST"]
      }
    },
    "detection_methods": {
      "type": "array",
      "description": "Methods to detect this misconfiguration",
      "items": {
        "type": "object",
        "properties": {
          "method": {
            "type": "string",
            "description": "Detection method name",
            "examples": ["AWS Config Rule", "CloudWatch Metric", "CLI Command", "API Call"]
          },
          "details": {
            "type": "string",
            "description": "Specific details or code for detection"
          }
        }
      }
    },
    "remediation_examples": {
      "type": "array",
      "description": "Code examples for remediation",
      "items": {
        "type": "object",
        "properties": {
          "language": {
            "type": "string",
            "examples": ["python", "bash", "terraform", "cloudformation", "aws-cli"]
          },
          "code": {
            "type": "string",
            "description": "Example code for remediation"
          },
          "description": {
            "type": "string",
            "description": "Explanation of what the code does"
          }
        }
      }
    }
  }
}
